# =========================================================
# Application Configuration
# =========================================================
spring.application.name=Booking-Service
server.port=8084

# =========================================================
# MongoDB Configuration (Docker)
# =========================================================
spring.data.mongodb.uri=mongodb://booking-mongodb:27017/booking-service
spring.data.mongodb.auto-index-creation=true

# =========================================================
# Security Configuration (Keycloak - Docker)
# =========================================================
# Keycloak server URL (internal Docker communication)
keycloak.auth-server-url=http://keycloak:8080
keycloak.realm=friendly-housing

# Resource Server Configuration (JWT Validation)
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8090/realms/friendly-housing
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8080/realms/friendly-housing/protocol/openid-connect/certs

# DISABLE OAuth2 Client Auto-Configuration (we only need Resource Server for JWT validation)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration

# =========================================================
# Microservices URLs (Docker)
# =========================================================
microservices.appointment-service.url=http://appointment-service-app:8083
microservices.property-service.url=http://property-service-app:8082
microservices.user-service.url=http://user-service-app:8081

# =========================================================
# RabbitMQ Configuration (Docker)
# =========================================================
spring.rabbitmq.host=shared-rabbitmq
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
spring.rabbitmq.enabled=true
# Add these lines

# ? ADD THESE 3 LINES:
rabbitmq.exchange.app=app-exchange
rabbitmq.routing-key.appointment=appointment.key
rabbitmq.routing-key.booking=booking.key

rabbitmq.queue.appointment=appointment-queue
rabbitmq.queue.booking=booking-queue

# WRONG (Docker):
#spring.rabbitmq.host=shared-rabbitmq

# CORRECT (Kubernetes):
#spring.rabbitmq.host=rabbitmq-service.student-housing.svc.cluster.local
# OR just:
#spring.rabbitmq.host=rabbitmq-service

# Optional: listener concurrency and prefetch
spring.rabbitmq.listener.simple.concurrency=3
spring.rabbitmq.listener.simple.max-concurrency=10
spring.rabbitmq.listener.simple.prefetch=1

# =========================================================
# Feign Client Configuration
# =========================================================
feign.client.config.default.connectTimeout=5000
feign.client.config.default.readTimeout=5000
feign.client.config.default.loggerLevel=basic

# =========================================================
# Logging Configuration
# =========================================================
logging.level.com.example.bookingservice=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.data.mongodb=DEBUG
logging.level.feign=DEBUG

# =========================================================
# Swagger / OpenAPI Documentation
# =========================================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true

# =========================================================
# Actuator
# =========================================================
management.endpoints.web.exposure.include=health,circuitbreakers,circuitbreakerevents,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoints.enabled-by-default=true

# =========================================================
# Resilience4J Circuit Breaker Configuration
# =========================================================
resilience4j.circuitbreaker.instances.userService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.userService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.userService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.userService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.userService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.userService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.userService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.userService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.userService.slowCallRateThreshold=50
resilience4j.circuitbreaker.instances.userService.slowCallDurationThreshold=2s

resilience4j.circuitbreaker.instances.propertyService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.propertyService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.propertyService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.propertyService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.propertyService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.propertyService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.propertyService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.propertyService.failureRateThreshold=50

resilience4j.circuitbreaker.instances.appointmentService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.appointmentService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.appointmentService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.appointmentService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.appointmentService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.appointmentService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.appointmentService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.appointmentService.failureRateThreshold=50

# Retry configuration
resilience4j.retry.instances.userService.maxAttempts=3
resilience4j.retry.instances.userService.waitDuration=1s
resilience4j.retry.instances.userService.enableExponentialBackoff=true
resilience4j.retry.instances.userService.exponentialBackoffMultiplier=2

resilience4j.retry.instances.propertyService.maxAttempts=3
resilience4j.retry.instances.propertyService.waitDuration=1s

resilience4j.retry.instances.appointmentService.maxAttempts=3
resilience4j.retry.instances.appointmentService.waitDuration=1s

# =========================================================
# Spring Cloud Configuration (Disable for Docker)
# =========================================================
spring.cloud.compatibility-verifier.enabled=false

# ========================================================================
# PROMETHEUS & MONITORING CONFIGURATION
# ========================================================================

m
management.endpoint.prometheus.enabled=true

management.metrics.tags.application=${spring.application.name}
management.metrics.tags.service=booking-service

# MongoDB metrics
management.metrics.mongo.command.enabled=true
management.metrics.mongo.connectionpool.enabled=true

# RabbitMQ metrics
management.metrics.rabbitmq.enabled=true


